<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>xterm.js minimal demo</title>
    <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css" />
    <script src="node_modules/@xterm/xterm/lib/xterm.js"></script>
    <script src="node_modules/@xterm/addon-fit/lib/addon-fit.js"></script>
    <script src="https://unpkg.com/hydra-synth"></script>

    <style>

    body {
      margin: 0;
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      font-family: sans-serif;
      cursor: url('cursor.png') 0 52, auto; /* fallback to default */
    }

    #hydraCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }
    
    .terminal-wrapper {
      position: relative;
      z-index: 1; /* on top of hydra canvas */
      background:  rgba(41,46,63,0.9);
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      overflow: hidden;
      width: 800px;
      max-width: 95%;
      margin: 40px auto;
    }

    .terminal-header {
      /* background: #3B4252; */
      background: rgba(41,46,63,0.9);
      height: 28px;
      display: flex;
      align-items: center;
      padding: 0 8px;
    }

    .terminal-buttons {
      display: flex;
      gap: 6px;
    }

    .terminal-btn {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .btn-close { background: #FF5F56; }
    .btn-min   { background: #FFBD2E; }
    .btn-max   { background: #27C93F; }

    #terminal {
      height: 300px;
      padding: 8px;
    }

    /* hide xterm scrollbar */
    .xterm-viewport {
    scrollbar-width: none !important;  /* Firefox */
    -ms-overflow-style: none !important;  /* IE 10+ */
    }

    .xterm-viewport::-webkit-scrollbar {  /* Chrome/Safari */
    display: none !important;
    }
  </style>

</head>
<body>
    <!-- Hydra canvas -->
    <canvas id="hydraCanvas"></canvas>

    <div style="padding: 20px;"></div>
    <div class="terminal-wrapper">
        <div class="terminal-header">
            <div class="terminal-buttons">
                <div class="terminal-btn btn-close"></div>
                <div class="terminal-btn btn-min"></div>
                <div class="terminal-btn btn-max"></div>
            </div>
        </div>
        <div id="terminal"></div>
  </div>

  <script type="module">

    // ---------- HYDRA ----------
    const hydraCanvas = document.getElementById("hydraCanvas");
    // Make canvas fill the screen at device resolution
    hydraCanvas.width = window.innerWidth * window.devicePixelRatio;
    hydraCanvas.height = window.innerHeight * window.devicePixelRatio;
    hydraCanvas.style.width = "100%";
    hydraCanvas.style.height = "100%";

    const hydra = new Hydra({ 
        canvas: hydraCanvas, 
        detectAudio: false, 
        width: hydraCanvas.width,
        height: hydraCanvas.height,
    });

    // Example pattern
    function hydraOption0() {
        osc(10, 0.1, 0.8)
        .kaleid(5)
        .rotate(0.3, 0.1)
        .color(0.2, 0.8, 1.0)
        .out();
    }


    function hydraWave() {
        // licensed with CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
        //filet mignon
        // AFALFL
        // instagram/a_f_alfl 
        osc(100,-0.0018,0.17).diff(osc(20,0.00008).rotate(Math.PI/0.00003))
            .modulateScale(noise(1.5,0.18).modulateScale(osc(13).rotate(()=>Math.sin(time/22))),3)
            .color(11,0.5,0.4, 0.9, 0.2, 0.011, 5, 22,  0.5, -1).contrast(1.4)
            .add(src(o0).modulate(o0,.04),.6, .9)
            //.pixelate(0.4, 0.2, 0.1)
            .invert().brightness(0.0003, 2).contrast( 0.5, 2, 0.1, 2).color(4, -2, 0.1)
            .modulateScale(osc(2),-0.2, 2, 1, 0.3)
            .posterize(200) .rotate(1, 0.2, 0.01, 0.001)
            .color(22, -2, 0.5, 0.5, 0.0001,  0.1, 0.2, 8).contrast(0.18, 0.3, 0.1, 0.2, 0.03, 1) . brightness(0.0001, -1, 10)
                .out()
    }

    function hydraVoronoi() {
        // licensed with CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
        //tropical juice
        //by Ritchse
        //instagram.com/ritchse
        voronoi(2,0.3,0.2).shift(0.5)
        .modulatePixelate(voronoi(4,0.2),32,2)
        .scale(()=>1+(Math.sin(time*2.5)*0.05))
        .diff(voronoi(3).shift(0.6))
        .diff(osc(2,0.15,1.1).rotate())
        .brightness(0.1).contrast(1.2).saturate(1.2)
            .out()
    }

    function hydraOjack() {
        // licensed with CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
        // by Olivia Jack
        // https://ojack.github.io

        osc(4, 0.1, 0.8).color(1.04,0, -1.1).rotate(0.30, 0.1).pixelate(2, 20).modulate(noise(2.5), () => 1.5 * Math.sin(0.08 * time)).out(o0)
    }

    function hydraOrbs() {
        // licensed with CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
        //CNDSD
        //http://malitzincortes.net/
        //ameba

        osc(15, 0.01, 0.1).mult(osc(1, -0.1).modulate(osc(2).rotate(4,1), 20))
        .color(0,2.4,5)
        .saturate(0.4)
        .luma(1,0.1, (6, ()=> 1 + a.fft[3]))
        .scale(0.7, ()=> 0.7 + a.fft[3])
        .diff(o0)// o0
        .out(o0)// o1
    }

    function hydraRetro() {
        // licensed with CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
        // by Zach Krall
        // http://zachkrall.online/

        osc(2, 0.9, 300)
        .color(0.9, 0.7, 0.8)
        .diff(
        osc(45, 0.3, 100)
        .color(0.9, 0.9, 0.9)
        .rotate(0.18)
        .pixelate(12)
        .kaleid()
        )
        .scrollX(10)
        .colorama()
        .luma()
        .repeatX(4)
        .repeatY(4)
        .modulate(
        osc(1, -0.9, 300)
        )
        .scale(2)

        .out()
    }



    const hydraFuncs = [hydraOption0, hydraWave, hydraVoronoi, hydraOjack, hydraOrbs];
    const randomIndex = Math.floor(Math.random() * hydraFuncs.length);

    // Get the random element
    const randomHydra = hydraFuncs[randomIndex];
    randomHydra();




    const nordTheme = {
        foreground: "#9ECE6A",
        background: "rgba(41,46,63,0.0)",
        cursor: "#9ECE6A",
        selection: "rgba(136,192,208,0.3)",

        black:   "#3B4252",
        red:     "#BF616A",
        green:   "#A3BE8C",
        yellow:  "#EBCB8B",
        blue:    "#81A1C1",
        magenta: "#B48EAD",
        cyan:    "#88C0D0",
        white:   "#9ECE6A",

        brightBlack:   "#4C566A",
        brightRed:     "#BF616A",
        brightGreen:   "#A3BE8C",
        brightYellow:  "#EBCB8B",
        brightBlue:    "#81A1C1",
        brightMagenta: "#B48EAD",
        brightCyan:    "#8FBCBB",
        brightWhite:   "#ECEFF4"
        };

    const term = new Terminal({ 
        cursorBlink: true, 
        convertEol: true, 
        theme: nordTheme,
        scrollback: 0   // disables scrollback buffer
    });
    const fit = new FitAddon.FitAddon(); // note the namespace
    term.loadAddon(fit);
    term.open(document.getElementById("terminal"));
    fit.fit();


    const PROMPT = "preston@blackburn:~$ ";
    let buffer = "";

    function prompt() {
        term.write("\r\n" + PROMPT);
        buffer = "";
    }

    // Initial prompt
    term.writeln("try running `help` for more info");
    prompt();


    term.onData(data => {
        if (data === "\x1b[A" || data === "\x1b[B" || data === "\x1b[C" || data === "\x1b[D") {
            return; // skip up/down/left/right arrows
        }

        for (const ch of data) {
        if (ch === "\r") {
            // Enter pressed â†’ echo back
            term.writeln("");
            handleCommand(buffer.trim());
            prompt();
        } else if (ch === "\u007F") {
            // Backspace
            if (buffer.length > 0) {
            buffer = buffer.slice(0, -1);
            term.write("\b \b");
            }
        } else {
            buffer += ch;
            term.write(ch);
        }
        }
    });

    function handleCommand(cmdLine) {
        if (cmdLine.length === 0) return;

        const [cmd, ...args] = cmdLine.split(/\s+/);

        switch (cmd) {
            case "help":
            term.writeln("Available commands:");
            term.writeln("  ls           - list blogs");
            term.writeln("  goto <blog>  - go to blog (ex: goto 'Example Blog')");
            term.writeln("  echo <text>  - echo arguments");
            term.writeln("  clear        - clear the terminal");
            term.writeln("  help         - show this help");
            break;

            case "clear":
            term.clear();
            break;


            case "ls":
            term.writeln("'Blog title a' 'Blog title b'");
            break;

            case "goto":
            if (args.length === 0) {
                term.writeln("Usage: goto <target>");
            } else {
                const target = args.join(" "); // <-- join all parts back
                // You can implement your custom logic here
                if (target === "'Blog title a'" || target === "Blog title a") {
                term.writeln("Navigating to 'Blog title a'...");
                setTimeout(() => {
                    term.write(".");
                }, 150);
                setTimeout(() => {
                    term.write(".");
                }, 300);
                setTimeout(() => {
                    term.write(".\r\n"); // finish with newline
                    // then actually navigate to the new tab
                    // Example: window.location.href = `/blog/${encodeURIComponent(target)}`;
                }, 500);
                // e.g. trigger navigation in your app:
                // window.location.href = `/blog/${target}`;
                } else {
                term.writeln(`Unknown target: ${target}`);
                }
            }
            break;


            case "echo":
            term.writeln(args.join(" "));
            break;

            default:
            term.writeln(`${cmd}: command not found`);
        }
        }

    // refit on resize
    addEventListener("resize", () => fit.fit());
  </script>
</body>
</html>
